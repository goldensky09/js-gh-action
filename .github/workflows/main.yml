on: [push]

jobs:
  storybook_indexing_n_cleanup_job:
    runs-on: ubuntu-latest
    name: A job to cleanup merged PR and update storybook index
    steps:
      # To use this repository's private action,
      # you must check out the repository
      - name: Checkout
        uses: actions/checkout@v3
      - name: Install and Build
        run: | # Install the packages
          npm install
      - uses: dorny/paths-filter@v2
        id: filter
        with:
          filters: |
            r:
              - 'r/**'
            pr:
              - 'pr/**'

      # run only if 'release' files were changed
      # - name: release updated
      #   if: steps.filter.outputs.r == 'true'
      #   run: ...

      # run if 'backend' or 'frontend' files were changed
      # - name: e2e tests
      #   if: steps.filter.outputs.backend == 'true' || steps.filter.outputs.frontend == 'true'
      #   run: ...
      - name: storybook versions update
        uses: ./ # Uses an action in the root directory
        id: storybooks_versions
        with:
          who-to-greet: 'Mona the Octocat'
      # Use the output from the `storybooks_versions` step
      - name: Get the output json content
        uses: DamianReeves/write-file-action
        with:
          path: ${{ env.home }}/sources-out.json
          contents: |
            echo "${{ steps.storybook_versions.outputs.content }}"
          write-mode: append